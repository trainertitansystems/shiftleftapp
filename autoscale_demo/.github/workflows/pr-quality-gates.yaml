name: PR Quality Gates

on:
  pull_request:
    branches: [ "main" ]

jobs:
  quality-gates:
    runs-on: ubuntu-latest

    steps:
      # ----------------------------------
      # SonarCloud Quality Gate
      # - waits for existing PR analysis
      # - skips forked PRs
      # ----------------------------------
      - name: SonarCloud Quality Gate
        if: >
          github.event.pull_request.head.repo.full_name == github.repository &&
          secrets.SONAR_TOKEN != ''
        uses: SonarSource/sonarcloud-github-action@6c0f3bba7a8d6f7f59d58a0b0a4fda3e2d6b9e1f
        with:
          args: >
            -Dsonar.qualitygate.wait=true
        env:
          SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}

